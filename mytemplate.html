<!DOCTYPE html>
{% extends 'base.html' %}
<!-- {% load crispy_forms_tags %} -->

{% block content %}
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>

<script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
    <!-- this is required for search  -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.23/af-2.3.5/b-1.6.5/b-colvis-1.6.5/b-html5-1.6.5/b-print-1.6.5/cr-1.5.3/fc-3.3.2/kt-2.5.3/r-2.2.6/rg-1.1.2/rr-1.2.7/sl-1.3.1/datatables.min.css"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>

  <!-- JavaScripts -->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-toggle/2.2.1/js/bootstrap-toggle.min.js"></script>

   <link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css">
   <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.6.5/css/buttons.dataTables.min.css">

   <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/1.6.5/js/dataTables.buttons.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
  <script src="https://cdn.datatables.net/buttons/1.6.5/js/buttons.html5.min.js" ></script>
  <script src="https://cdn.datatables.net/buttons/1.6.5/js/buttons.print.min.js"></script>




    <!-- Datatables -->
    <script src="https://cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.11/js/dataTables.bootstrap.min.js"></script>



     <script>
     $(document).ready(function() {
     $('#datatable_id').DataTable( {
       // dom: 'Bfrtip',
       // buttons: [
       //     'copyHtml5', 'csvHtml5', 'excelHtml5', 'pdfHtml5'
       //     ]
   } );
   } );
   </script>

    <style>
input[type=submit] {
  background-color: #007bff;
  border: 1px solid;
  padding: .375rem .75rem;
  color: white;
  font-weight: 400;
  vertical-align: middle;
  text-align: center;
  display: inline-block;
  font-size: 1rem;
  padding: 12px 16px;
  line-height: 0.55;

  text-decoration: none;
  margin: 4px 2px;
  cursor: pointer;
  border-radius:.25rem;
  box-sizing: border-box;
}
</style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js" type='text/javascript'></script> -->
    <script>
      $('.form-group').ready(function(){

        var Dieseltotal = 0;
        $('td:nth-child(9)').each(function(){
          var Diesel = $(this).html();
          if($.isNumeric(Diesel)){
            Dieseltotal += parseInt(Diesel);
          }
        });
        $('#Dieselresult').text(Dieseltotal);
      });


      $('.form-group').ready(function(){

        var Foodtotal = 0;
        $('td:nth-child(8)').each(function(){
          var Food = $(this).html();
          if($.isNumeric(Food)){
            Foodtotal += parseInt(Food);
          }
        });
        $('#Foodresult').text(Foodtotal);
      });

      $('.form-group').ready(function(){

        var Tolltotal = 0;
        $('td:nth-child(7)').each(function(){
          var Toll = $(this).html();
          if($.isNumeric(Toll)){
            Tolltotal += parseInt(Toll);
          }
        });
        $('#Tollresult').text(Tolltotal);
      });

      $('.form-group').ready(function(){

        var Maintenancetotal = 0;
        $('td:nth-child(10)').each(function(){
          var Maintenance = $(this).html();
          if($.isNumeric(Maintenance)){
            Maintenancetotal += parseInt(Maintenance);
          }
        });
        $('#Maintenanceresult').text(Maintenancetotal);
      });


      $('.form-group').ready(function(){

        var Permittotal = 0;
        $('td:nth-child(11)').each(function(){
          var Permit = $(this).html();
          if($.isNumeric(Permit)){
            Permittotal += parseInt(Permit);
          }
        });
        $('#Permitresult').text(Permittotal);
      });


      $('.form-group').ready(function(){

        var Insurancetotal = 0;
        $('td:nth-child(12)').each(function(){
          var Insurance = $(this).html();
          if($.isNumeric(Insurance)){
            Insurancetotal += parseInt(Insurance);
          }
        });
        $('#Insuranceresult').text(Insurancetotal);
      });

      $('.form-group').ready(function(){

        var Invoice_detailstotal = 0;
        $('td:nth-child(14)').each(function(){
          var Invoice_details = $(this).html();
          if($.isNumeric(Invoice_details)){
            Invoice_detailstotal += parseInt(Invoice_details);
          }
        });
        $('#Invoice_detailsresult').text(Invoice_detailstotal);
      });



    $(document).ready(function(){
    $('tr').each(function(){
      var CostPerKmtotal=0;
      var difference = 0;
      $(this).find('.subjects').each(function(){
        var total = $(this).text();
        if(total.value!==0 || total.value===0)
        {
          CostPerKmtotal+=parseFloat(total);
        }

      });

      $(this).find('.diff').each(function(){
        console.log($(this).html());

      });
      difference = parseFloat($(this).find(".diff2").html()) - parseFloat($(this).find(".diff1").html());
      //console.log($(this).html(difference));

      $(this).find('#CostPerKmresult').html(Math.abs(CostPerKmtotal/difference).toFixed(2));
    });

    });


    </script>


  </head>
  <body>





{% if data %}
    <form method="POST" enctype="multipart/form-data">
  <!-- Security token -->
  {% csrf_token %}
<div class="my-4">
  <span>From Date:</span>
  <input type="date" name="start_date" id="myDate1" value="2000-02-02">
  <span>To Date:</span>
  <input type="date" name="end_date" id="myDate2" value="2020-02-02">
  <br>
  <br>

  <!-- <button type="button" class="btn btn-primary" value="Submit">Submit</button> -->

  <input type="Submit" name="" value="Submit">
  <br>
  <br>
  </div>
</form>


<div class="col-md-12">
        <h4> Datatable For The Above Filter</h4>
        <div class="table-responsive">
  <table id="datatable_id" class="table  table-hover table-striped table-bordered" width="100%">
            <thead>
                <th><input type="checkbox" id="checkall" /></th>
                <th>name</th>
                <th>Vehicle</th>
                <th>date</th>
                <th>start_km</th>
                <th>end_km</th>
                <th>Toll</th>
                <th>Food</th>
                <th>Diesel</th>
                <th>Maintenance</th>
                <th>Permit</th>
                <th>Insurance</th>
                <th>CostPerKm</th>
                <th>Invoice_details</th>
                <th>Vendorname</th>
             </thead>
      <tbody>
        {% for value in data %}
        <tr>
          <!-- <td>{{ value.Name }}</td>
          <td>{{ value.Vehicle }}</td>
          <td>{{ value.Date }}</td>
          <td class="diff1">{{ value.Start_km}}</td>
          <td class="diff2">{{ value.End_km}}</td>
          <td class="subjects">{{ value.Toll}}</td>
          <td class="subjects">{{ value.Food}}</td>
          <td class="subjects">{{ value.Diesel}}</td>
          <td class="subjects">{{ value.Maintenance}}</td>
          <td class="subjects">{{ value.Permit}}</td>
          <td class="subjects">{{ value.Insurance }}</td>
          <td id ="CostPerKmresult"></td>
          <td>{{ value.Invoice_details }}</td>
          <td>{{ value.Vendorname }}</td> -->

          <td><input type="checkbox" class="checkthis" /></td>
          <td>   {{ value.Name }} </td>
          <td>{{ value.Vehicle }}</td>
          <td>{{ value.Date }}</td>
          <td class="diff1">{{ value.Start_km}}</td>
          <td class="diff2">{{ value.End_km}}</td>
          <td class="subjects">{{ value.Toll}}</td>
          <td class="subjects">{{ value.Food}}</td>
          <td class="subjects">{{ value.Diesel}}</td>
          <td class="subjects">{{ value.Maintenance}}</td>
          <td class="subjects">{{ value.Permit}}</td>
          <td class="subjects">{{ value.Insurance }}</td>
          <td id ="CostPerKmresult"></td>
          <td>{{ value.Invoice_details }}</td>
          <td>{{ value.Vendorname }}</td>
          <!-- <td><p data-placement="top" data-toggle="tooltip" title="Edit"><a href="/edit/{{ employee.id }}" class="btn btn-primary btn-xs" data-title="Edit" data-toggle="modal" data-target="#edit" ><span class="glyphicon glyphicon-pencil"></span></a></p></td>
          <td><p data-placement="top" data-toggle="tooltip" title="Delete"><a href="/delete/{{ employee.id }}" class="btn btn-danger btn-xs" data-title="Delete" data-toggle="modal" data-target="#delete" ><span class="glyphicon glyphicon-trash"></span></a></p></td> -->
          </tr>


        </tr>
      {% empty %}
        <tr>
          <td colspan="14">No data</td>
        </tr>
      {% endfor %}

    </tbody>

    <tr>
      <td ></td>
      <td > Total </td>
      <td ></td>
      <td ></td>
      <td ></td>
      <td ></td>
      <td colspan="1" id ="Tollresult"></td>
      <td colspan="1" id ="Foodresult"></td>
      <td colspan="1" id ="Dieselresult"></td>
      <td colspan="1" id ="Maintenanceresult"></td>
      <td colspan="1" id ="Permitresult"></td>
      <td colspan="1" id = "Insuranceresult"></td>
      <td ></td>
      <td colspan="1" id = "Invoice_detailsresult"></td>
      <td ></td>

    </tr>


    </table>

  </div>
  </div>

    <div class="my-4">


    <a href="{% url 'leadlogisticsApp:export_data' %}"><button type="button" class="btn btn-primary" name="Next">Export data here</button></a>

    </div>



    {% else %}

    <form method="POST" enctype="multipart/form-data">

  <!-- Security token -->
  {% csrf_token %}

  <!-- {{ form.as_p}} -->
  <div class="my-4">

  <span>From Date:</span>
  <input type="date"   name="start_date" value="2000-02-02" placeholder="02/02/2000">
  <span>To Date:</span>
  <input type="date" name="end_date" value="2020-02-02" placeholder="02/02/2000">
  <br>
  <br>

  <!-- <button type="button" class="btn btn-primary" value="Submit">Submit</button> -->
  <input type="submit" name="" value="Submit">
<br>
<br>


  </div>

  {% endif %}

</form>



  </body>
</html>
{% endblock %}
